# Исправление проблемы с добавлением тематик и запрещенных тематик

## Проблема

Тематики и запрещенные тематики не добавлялись при сохранении профиля. Пользователи могли выбирать тематики в интерфейсе, но они не сохранялись на сервере.

## Причина

Проблема была в дублировании логики конвертации названий тем в ID. В компоненте `BloggerInfo.tsx` происходила конвертация названий тем в ID, а затем в `mapLocalToApiUpdate` эта же конвертация происходила повторно, что могло приводить к ошибкам или потере данных.

### Детали проблемы:

1. **В `BloggerInfo.tsx`**: Происходила конвертация названий тем в ID перед передачей в `onSave`
2. **В `mapLocalToApiUpdate`**: Происходила повторная конвертация через `convertTopicsToIds`
3. **Дублирование логики**: Две конвертации могли конфликтовать или приводить к потере данных
4. **Неправильная передача данных**: Данные могли передаваться в неправильном формате

## Решение

### Упрощение логики конвертации

**Файл:** `src/components/profile/BloggerInfo.tsx`

Убрана дублирующая конвертация в `handleSave`:

```typescript
// ДО (неправильно):
const handleSave = useCallback(() => {
  const editData = stateToEditData(state);
  
  // Конвертируем названия тем в ID для API
  const topicsWithIds = {
    ...editData,
    topics: editData.topics?.map(topic => 
      typeof topic === 'string' ? topicLookup[topic] : topic
    ).filter(id => typeof id === 'number') || [],
    banned_topics: editData.banned_topics?.map(topic => 
      typeof topic === 'string' ? topicLookup[topic] : topic
    ).filter(id => typeof id === 'number') || []
  };
  
  onSave(topicsWithIds);
  onEditingChange(null);
}, [state, onSave, onEditingChange, topicLookup]);

// ПОСЛЕ (правильно):
const handleSave = useCallback(() => {
  const editData = stateToEditData(state);
  
  // Передаем данные как есть - конвертация будет в mapLocalToApiUpdate
  onSave(editData);
  onEditingChange(null);
}, [state, onSave, onEditingChange]);
```

### Логика обработки тематик:

1. **В `BloggerInfo`**: Данные передаются как есть (названия или ID)
2. **В `mapLocalToApiUpdate`**: Происходит единая конвертация через `convertTopicsToIds`
3. **В `convertTopicsToIds`**: Корректно обрабатываются как названия, так и ID
4. **В API**: Отправляются только числовые ID

## Результат

✅ **Тематики сохраняются** корректно на сервере  
✅ **Запрещенные тематики сохраняются** корректно на сервере  
✅ **Убрана дублирующая логика** конвертации  
✅ **Упрощен код** и улучшена надежность  
✅ **Обратная совместимость** сохранена

## Тестирование

### Сценарий 1: Добавление тематик
1. Открыть форму редактирования профиля
2. Выбрать несколько тематик
3. Сохранить изменения
4. **Ожидаемый результат:** Тематики сохраняются и отображаются

### Сценарий 2: Добавление запрещенных тематик
1. Выбрать запрещенные тематики
2. Сохранить изменения
3. **Ожидаемый результат:** Запрещенные тематики сохраняются

### Сценарий 3: Комбинированное редактирование
1. Изменить тематики, запрещенные тематики и другие поля
2. Сохранить все изменения
3. **Ожидаемый результат:** Все изменения сохраняются корректно

### Сценарий 4: Обновление страницы
1. Сохранить тематики
2. Обновить страницу
3. **Ожидаемый результат:** Тематики остаются сохраненными

## Файлы изменений

1. `src/components/profile/BloggerInfo.tsx` - убрана дублирующая конвертация в `handleSave`

## Совместимость

- ✅ Обратная совместимость сохранена
- ✅ Существующие тематики продолжают работать
- ✅ Логика в `mapLocalToApiUpdate` не изменилась
- ✅ Все существующие функции (загрузка, отображение) работают как прежде

## Workflow для тематик

1. **Пользователь выбирает тематики** → данные сохраняются в состоянии `BloggerInfo`
2. **При сохранении** → данные передаются в `onSave` как есть
3. **В `mapLocalToApiUpdate`** → происходит конвертация через `convertTopicsToIds`
4. **В `convertTopicsToIds`** → названия конвертируются в ID, ID остаются как есть
5. **Отправка в API** → только числовые ID отправляются на сервер
6. **Сохранение** → тематики сохраняются в базе данных

## Преимущества

- **Упрощение**: Убрана дублирующая логика
- **Надежность**: Единая точка конвертации данных
- **Консистентность**: Все тематики обрабатываются одинаково
- **Отладка**: Легче отследить проблемы с конвертацией
