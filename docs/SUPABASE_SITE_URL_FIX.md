# Исправление неправильного редиректа после подтверждения email

## Проблема

После перехода по ссылке из email пользователь перенаправляется на неправильный домен:
```
https://db.zorki.pro/auth/v1/verify?token=...&type=signup&redirect_to=https://db.zorki.pro/auth/v1
```

Вместо прямого редиректа на ваш сайт (`https://zorki.pro`).

## Причина

В настройках Supabase проекта указан неправильный **Site URL**. Supabase использует этот URL как базовый для всех редиректов.

## Решение

### 1. Исправить Site URL в Supabase

1. Откройте панель Supabase для проекта `https://db.zorki.pro`
2. Перейдите в **Settings** → **Authentication**
3. Найдите раздел **Site URL**
4. Измените на:
   - **Для разработки:** `http://localhost:8085`
   - **Для продакшена:** `https://zorki.pro` (или ваш основной домен)
5. Сохраните изменения

### 2. Добавить Redirect URLs

В том же разделе **Settings** → **Authentication** найдите **Redirect URLs** и добавьте:

```
http://localhost:8085/**
https://zorki.pro/**
https://www.zorki.pro/**
```

**Важно:** Используйте `/**` в конце, чтобы разрешить все подпути.

### 3. Проверить настройки URL

Убедитесь, что:
- **Site URL** указывает на ваш основной домен
- **Redirect URLs** содержат все необходимые домены (включая localhost для разработки)
- **Additional Redirect URLs** (если есть) также настроены правильно

## Что происходит после исправления

После исправления настроек:

1. Пользователь переходит по ссылке из email
2. Supabase обрабатывает токен и перенаправляет на ваш Site URL (например, `https://zorki.pro/`)
3. Приложение автоматически обрабатывает сессию через `AuthRedirectHandler`
4. Пользователь перенаправляется на:
   - `/profile-setup` - если профиль еще не создан
   - `/profile/edit` - если профиль уже создан

## Временное решение (если не можете изменить настройки)

Если вы не можете изменить настройки Supabase сразу, код уже обновлен для использования `window.location.origin` как redirect URL. Это должно помочь, но основная проблема все равно в настройках Supabase.

## Проверка

После исправления:

1. Зарегистрируйте новый аккаунт
2. Перейдите по ссылке из email
3. Вы должны попасть на ваш сайт (не на `stg.tbots.pro`)
4. После подтверждения вы будете перенаправлены на `/profile-setup` или `/profile/edit`

## Примечания

- `stg.tbots.pro` - это старый/неправильный домен, который был настроен в Supabase ранее
- Все редиректы должны идти через ваш домен, а не через Supabase промежуточный URL
- После исправления старые ссылки из email могут не работать - пользователям нужно будет зарегистрироваться заново или запросить новое письмо подтверждения





