# Исправление исчезновения скриншотов после обновления страницы

## Проблема

Скриншоты пропадали после обновления страницы, но появлялись после загрузки хотя бы одного скриншота. Это создавало неконсистентное поведение и плохой пользовательский опыт.

## Причина

Проблема была в отсутствии синхронизации между `useScreenshotManager` и `availablePlatforms` при загрузке скриншотов. После обновления страницы:

1. **`useScreenshotManager`** загружал скриншоты из API
2. **`availablePlatforms`** не обновлялся с загруженными скриншотами
3. **`ScreenshotManagement`** получал скриншоты из `stats.screenshots` (из `availablePlatforms`)
4. **Результат**: Скриншоты не отображались, хотя были загружены

При загрузке нового скриншота:
1. **`useScreenshotManager`** обновлял локальное состояние
2. **Вызывался callback** `onScreenshotsUpdate` для обновления `availablePlatforms`
3. **Результат**: Все скриншоты появлялись

### Детали проблемы:

1. **Отсутствие синхронизации при загрузке**: `useScreenshotManager` не обновлял `availablePlatforms` при первоначальной загрузке скриншотов
2. **Синхронизация только при изменениях**: Callback `onScreenshotsUpdate` вызывался только при загрузке/удалении скриншотов
3. **Несогласованность состояния**: `useScreenshotManager` и `availablePlatforms` содержали разные данные

## Решение

### Добавление синхронизации при загрузке

**Файл:** `src/hooks/profile/useScreenshotManager.ts`

Добавлен `useEffect` для синхронизации скриншотов с `availablePlatforms` при загрузке:

```typescript
import { useCallback, useEffect } from "react";

// Синхронизируем скриншоты с availablePlatforms при загрузке
useEffect(() => {
  if (screenshots.length > 0 && onScreenshotsUpdate) {
    onScreenshotsUpdate(platform, screenshots);
  }
}, [screenshots, platform, onScreenshotsUpdate]);
```

### Логика синхронизации:

1. **При загрузке скриншотов**: `useScreenshotLoader` загружает скриншоты из API
2. **При изменении `screenshots`**: `useEffect` проверяет есть ли скриншоты и callback
3. **Если есть скриншоты и callback**: Вызывается `onScreenshotsUpdate(platform, screenshots)`
4. **Обновляется `availablePlatforms`**: Скриншоты добавляются в `stats.screenshots`
5. **Отображаются в интерфейсе**: `ScreenshotManagement` получает скриншоты из `stats.screenshots`

## Результат

✅ **Скриншоты сохраняются** после обновления страницы  
✅ **Консистентное поведение** между загрузкой и обновлением  
✅ **Синхронизация состояния** между `useScreenshotManager` и `availablePlatforms`  
✅ **Работает для всех платформ** (Instagram, YouTube, TikTok, Telegram)  
✅ **Обратная совместимость** сохранена

## Тестирование

### Сценарий 1: Обновление страницы
1. Загрузить скриншоты для Instagram
2. Обновить страницу
3. **Ожидаемый результат:** Скриншоты остаются на месте

### Сценарий 2: Переключение между платформами
1. Загрузить скриншоты для разных платформ
2. Переключаться между табами
3. Обновить страницу
4. **Ожидаемый результат:** Скриншоты остаются для всех платформ

### Сценарий 3: Загрузка новых скриншотов
1. Обновить страницу (скриншоты должны остаться)
2. Загрузить новый скриншот
3. **Ожидаемый результат:** Новый скриншот добавляется к существующим

### Сценарий 4: Удаление скриншотов
1. Удалить скриншот
2. Обновить страницу
3. **Ожидаемый результат:** Скриншот остается удаленным

## Файлы изменений

1. `src/hooks/profile/useScreenshotManager.ts` - добавлен `useEffect` для синхронизации при загрузке

## Совместимость

- ✅ Обратная совместимость сохранена
- ✅ Существующие функции работают как прежде
- ✅ Callback опциональный - если не передан, работает как раньше
- ✅ Все существующие проверки (валидация, лимиты файлов) продолжают работать

## Workflow для синхронизации скриншотов

1. **Загрузка страницы** → `useScreenshotManager` инициализируется
2. **Загрузка скриншотов** → `useScreenshotLoader` получает данные из API
3. **Синхронизация** → `useEffect` вызывает `onScreenshotsUpdate`
4. **Обновление `availablePlatforms`** → скриншоты добавляются в `stats.screenshots`
5. **Отображение** → `ScreenshotManagement` получает скриншоты из `stats.screenshots`
6. **Обновление страницы** → процесс повторяется, скриншоты остаются

## Преимущества

- **Консистентность**: Скриншоты всегда отображаются одинаково
- **Надежность**: Работает для всех сценариев (загрузка, обновление, переключение)
- **Производительность**: Минимальные изменения в коде
- **UX**: Пользователь видит скриншоты сразу после загрузки страницы
