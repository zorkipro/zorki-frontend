# Исправление несоответствия в маппинге workFormat LLC vs LIMITED_LIABILITY_COMPANY

## Проблема

Пользователь менял "Правовая форма" с "ИП" на "ООО", но после обновления страницы снова показывалось "ИП". Проблема была в несоответствии маппинга API значений для "ООО" в разных частях кода.

### Описание проблемы:
- Пользователь выбирает "ООО" в селекторе правовой формы
- Изменения сохраняются на сервере
- После обновления страницы снова показывается "ИП"
- Данные не загружаются корректно из-за несоответствия в маппинге

## Причина

Проблема была в том, что в `src/utils/draft-helpers.ts` использовалось `"LIMITED_LIABILITY_COMPANY"`, а в API типах определено `"LLC"`. Это несоответствие приводило к тому, что при загрузке данных "ООО" не распознавалось правильно.

### Детали проблемы:

1. **В API типах**: `ApiWorkFormat` определен как `"LLC"`
2. **В draft-helpers.ts**: Использовалось `"LIMITED_LIABILITY_COMPANY"`
3. **В других мапперах**: Правильно использовалось `"LLC"`
4. **При загрузке**: `"LLC"` не распознавался в `draft-helpers.ts`
5. **Fallback**: Возвращался `"ИП"` по умолчанию

### Несоответствие в коде:

```typescript
// В src/api/types.ts (правильно):
export type ApiWorkFormat = "SOLE_PROPRIETOR" | "SELF_EMPLOYED" | "SERVICE_CONTRACT" | "LLC";

// В src/utils/draft-helpers.ts (неправильно):
case "LIMITED_LIABILITY_COMPANY":  // ❌ Неправильно
  return "ООО";

// В других мапперах (правильно):
case "LLC":  // ✅ Правильно
  return "ООО";
```

## Решение

### Исправление маппинга в draft-helpers.ts

**Файл:** `src/utils/draft-helpers.ts`

Исправлен маппинг для соответствия API типам:

```typescript
// ДО (неправильно):
function mapWorkFormatFromApi(
  apiFormat?: string,
): "ИП" | "профдоход" | "договор подряда" | "ООО" | undefined {
  if (!apiFormat) return undefined;

  switch (apiFormat) {
    case "SOLE_PROPRIETOR":
      return "ИП";
    case "SELF_EMPLOYED":
      return "профдоход";
    case "SERVICE_CONTRACT":
      return "договор подряда";
    case "LIMITED_LIABILITY_COMPANY":  // ❌ Неправильно
      return "ООО";
    default:
      return "ИП";
  }
}

// ПОСЛЕ (правильно):
function mapWorkFormatFromApi(
  apiFormat?: string,
): "ИП" | "профдоход" | "договор подряда" | "ООО" | undefined {
  if (!apiFormat) return undefined;

  switch (apiFormat) {
    case "SOLE_PROPRIETOR":
      return "ИП";
    case "SELF_EMPLOYED":
      return "профдоход";
    case "SERVICE_CONTRACT":
      return "договор подряда";
    case "LLC":  // ✅ Правильно
      return "ООО";
    default:
      return "ИП";
  }
}
```

### Логика исправления:

1. **Убрано несоответствие**: `"LIMITED_LIABILITY_COMPANY"` заменено на `"LLC"`
2. **Соответствие API**: Теперь используется правильное значение из `ApiWorkFormat`
3. **Единообразие**: Все мапперы используют одинаковые значения
4. **Корректная загрузка**: "ООО" теперь правильно распознается при загрузке

### Проверка других мапперов:

Все остальные мапперы уже использовали правильные значения:
- ✅ `src/api/types.ts`: `LLC: "ООО"`
- ✅ `src/utils/api/admin-blogger-mappers.ts`: `'LLC': 'ООО'`
- ✅ `src/utils/api/profile-mappers.ts`: `WORK_FORMAT_MAP[api.workFormat]`
- ✅ `src/utils/api/draft-merge-mappers.ts`: `workFormat` напрямую из API

## Результат

✅ **Правовая форма сохраняется** корректно  
✅ **Правовая форма загружается** корректно  
✅ **Единообразный маппинг** во всех компонентах  
✅ **Соответствие API типам** обеспечено  
✅ **Обратная совместимость** сохранена

## Тестирование

### Сценарий 1: Изменение правовой формы
1. Открыть форму редактирования профиля
2. Изменить "Правовая форма" с "ИП" на "ООО"
3. Сохранить изменения
4. **Ожидаемый результат:** Правовая форма сохраняется как "ООО"

### Сценарий 2: Загрузка после обновления
1. Обновить страницу после сохранения "ООО"
2. **Ожидаемый результат:** Правовая форма отображается как "ООО"

### Сценарий 3: Все варианты правовой формы
1. Проверить все варианты: "ИП", "профдоход", "договор подряда", "ООО"
2. **Ожидаемый результат:** Все варианты сохраняются и загружаются корректно

## Файлы изменений

1. `src/utils/draft-helpers.ts` - исправлен маппинг `"LIMITED_LIABILITY_COMPANY"` → `"LLC"`

## Совместимость

- ✅ Обратная совместимость сохранена
- ✅ Работает со всеми вариантами правовой формы
- ✅ Единообразный маппинг во всех компонентах
- ✅ Все существующие функции работают как прежде

## Workflow для правовой формы

1. **Пользователь выбирает** → "ООО" в селекторе
2. **Сохранение** → `mapWorkFormatToApi('ООО')` → `'LLC'`
3. **Отправка в API** → `workFormat: 'LLC'`
4. **Загрузка с API** → `workFormat: 'LLC'`
5. **Конвертация** → `mapWorkFormatFromApi('LLC')` → `'ООО'`
6. **Отображение** → "ООО" в селекторе

## Преимущества

- **Надежность**: Корректный маппинг API значений
- **Единообразие**: Одинаковые значения во всех мапперах
- **Соответствие**: Правильное использование API типов
- **Стабильность**: Избегаем fallback на значения по умолчанию
